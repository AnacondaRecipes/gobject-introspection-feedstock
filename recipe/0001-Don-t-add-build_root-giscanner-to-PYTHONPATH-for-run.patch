From a159ba5a207e8aba2895eb1101f97a58e33dfc45 Mon Sep 17 00:00:00 2001
From: Andrii Osipov <aosipov@anaconda.com>
Date: Thu, 26 Jun 2025 03:07:07 -0700
Subject: [PATCH] Don't add build_root/giscanner to PYTHONPATH for running
 tests.

---
 tests/warn/meson.build      | 3 ++-
 tests/warn/warningtester.py | 5 ++---
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/tests/warn/meson.build b/tests/warn/meson.build
index d55c1e9..597afa7 100644
--- a/tests/warn/meson.build
+++ b/tests/warn/meson.build
@@ -21,8 +21,9 @@ warn_tests = [
 ]
 
 warn_test_env = environment()
-warn_test_env.set('UNINSTALLED_INTROSPECTION_SRCDIR', source_root)
+warn_test_env.set('TOP_SRCDIR', source_root)
 warn_test_env.set('TOP_BUILDDIR', build_root)
+warn_test_env.set('PYTHONPATH', build_root)
 
 # FIXME: Glib as a subproject (used on Windows mostly).
 if glib_dep.type_name() == 'pkgconfig'
diff --git a/tests/warn/warningtester.py b/tests/warn/warningtester.py
index ff7a539..28b2141 100644
--- a/tests/warn/warningtester.py
+++ b/tests/warn/warningtester.py
@@ -3,7 +3,7 @@ import sys
 import difflib
 import builtins
 
-path = os.getenv('UNINSTALLED_INTROSPECTION_SRCDIR', None)
+path = os.getenv('TOP_SRCDIR', None)
 assert path is not None
 # Not correct, but enough to get the tests going uninstalled
 builtins.__dict__['DATADIR'] = path
@@ -11,7 +11,6 @@ builtins.__dict__['GIR_DIR'] = path
 
 path = os.getenv('TOP_BUILDDIR', None)
 assert path is not None
-sys.path.insert(0, path)
 
 from giscanner.annotationparser import GtkDocCommentBlockParser
 from giscanner.ast import Include, Namespace
@@ -26,7 +25,7 @@ from giscanner.scannermain import process_packages
 currentdir = os.path.dirname(os.path.abspath(sys.argv[0]))
 current_name = os.path.basename(currentdir)
 path = os.path.abspath(os.path.join(currentdir, '..', ''))
-top_srcdir = os.environ['UNINSTALLED_INTROSPECTION_SRCDIR']
+top_srcdir = os.environ['TOP_SRCDIR']
 top_builddir = os.environ['TOP_BUILDDIR']
 
 
-- 
2.39.3 (Apple Git-146)

